<div class="container mt-2">
  <div class="row justify-content-center">
    <div class="col-md-25">
      <div class="card p-2 shadow-lg">
        <h2 class="mb-3">Uploader votre CV (PDF)</h2>

        <!-- Fichier PDF -->
        <input
          type="file"
          (change)="onFileSelected($event)"
          accept="application/pdf"
          class="form-control mb-3"
          id="pdfUpload"
          aria-label="Sélectionner un fichier PDF"
        />

        <!-- Erreur -->
        <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
          {{ errorMessage }}
        </div>

        <!-- Bouton Upload -->
        <button
          class="btn btn-primary mb-3"
          (click)="uploadCV()"
          [disabled]="!selectedFile"
        >
          <i class="bi bi-download"></i> Upload CV
        </button>

        <!-- Barre de progression Upload -->
        <div *ngIf="uploadProgress > 0 && uploadProgress < 100" class="progress mb-3">
          <div
            class="progress-bar"
            role="progressbar"
            [style.width.%]="uploadProgress"
            [attr.aria-valuenow]="uploadProgress"
            aria-valuemin="0"
            aria-valuemax="100"
          >
            {{ uploadProgress }}%
          </div>
        </div>

        <!-- Preview + Résultat -->
        <div class="row mt-4">
          <!-- Aperçu PDF -->
          <div *ngIf="pdfSrc" class="col-md-6">
            <h5 class="mb-3">Aperçu du CV :</h5>
            <ngx-extended-pdf-viewer
              [src]="pdfSrc"
              [useBrowserLocale]="true"
              [height]="'900px'"
              [showSidebarButton]="true"
              [showZoomButtons]="true"
              [showPrintButton]="true"
              [showDownloadButton]="true"
              [showPagingButtons]="true"
            ></ngx-extended-pdf-viewer>
          </div>

          <!-- Résultat -->
          <div class="col-md-6">
            <!-- Bouton Get My Note -->
            <button
              class="btn btn-success mb-3"
              (click)="getMyNote()"
              [disabled]="!pdfisupdated"
            >
              <i class="bi bi-bar-chart-line"></i> Get My Note
            </button>

            <!-- Progression Get My Note -->
            <div *ngIf="isGettingNote" class="progress mb-3">
              <div
                class="progress-bar progress-bar-striped progress-bar-animated"
                role="progressbar"
                [style.width.%]="getNoteProgress"
                [attr.aria-valuenow]="getNoteProgress"
                aria-valuemin="0"
                aria-valuemax="100"
              >
                {{ getNoteProgress }}%
              </div>
            </div>

            <!-- Custom Analyzer -->
            <div *ngIf="customScore" class="card shadow-sm border-0">
              <div class="card-body">
                <h4 class="card-title text-primary"><i class="bi bi-person-check"></i> Résultats de l'analyse</h4>

                <!-- Total Score -->
                <p>
                  <strong>Total Score:</strong>
                  <span class="badge ms-2" [ngClass]="getBadgeClass(customScore.total_score)">
                    {{ customScore.total_score }}
                  </span>
                </p>

                <!-- Compétences -->
                <div class="mb-2">
                  <strong>Compétences :</strong>
                  <span class="badge ms-2" [ngClass]="getBadgeClass(customScore.detailed_scores.skills)">
                    {{ customScore.detailed_scores.skills }}
                  </span>
                </div>

                <!-- Expérience -->
                <div class="mb-2">
                  <strong>Expérience :</strong>
                  <span class="badge ms-2" [ngClass]="getBadgeClass(customScore.detailed_scores.experience)">
                    {{ customScore.detailed_scores.experience }}
                  </span>
                </div>

                <!-- Éducation -->
                <div class="mb-2">
                  <strong>Éducation :</strong>
                  <span class="badge ms-2" [ngClass]="getBadgeClass(customScore.detailed_scores.education)">
                    {{ customScore.detailed_scores.education }}
                  </span>
                </div>

                <!-- Détail Expérience -->
                <div class="mt-3">
                  <strong>Expérience détaillée :</strong>
                  <p class="text-muted">{{ customScore.experience_metrics.details }}</p>
                </div>

                <!-- Feedback -->
                <div *ngIf="customScore.feedback?.length">
                  <strong>Feedback :</strong>
                  <ul class="list-group list-group-flush">
                    <li *ngFor="let fb of customScore.feedback" class="list-group-item">
                      {{ fb }}
                    </li>
                  </ul>
                </div>

                <!-- Bouton Chat -->
                <div *ngIf="customScore.total_score > 50" class="mt-4 text-end">
                  <button class="btn btn-outline-primary" (click)="goToChat()">
                    <i class="bi bi-chat-dots"></i> Go to Chat Interview
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div> <!-- end row -->
      </div>
    </div>
  </div>
</div>
