<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card p-4">
        <h2 class="mb-3">Uploader votre CV (PDF)</h2>

        <input
          type="file"
          (change)="onFileSelected($event)"
          accept="application/pdf"
          class="form-control mb-3"
          id="pdfUpload"
          aria-label="Sélectionner un fichier PDF"
        />

        <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
          {{ errorMessage }}
        </div>

        <button
          class="btn btn-primary mb-3"
          (click)="uploadCV()"
          [disabled]="!selectedFile"
          aria-label="Uploader le CV"
        >
          Upload CV
        </button>

        <div *ngIf="uploadProgress > 0 && uploadProgress < 100" class="progress mb-3">
          <div
            class="progress-bar"
            role="progressbar"
            [style.width.%]="uploadProgress"
            [attr.aria-valuenow]="uploadProgress"
            aria-valuemin="0"
            aria-valuemax="100"
          >
            {{ uploadProgress }}%
          </div>
        </div>

        <div *ngIf="pdfSrc" class="pdf-preview mt-4">
          <h5>Aperçu du CV :</h5>
          <ngx-extended-pdf-viewer
            [src]="pdfSrc"
            [useBrowserLocale]="true"
            [height]="'1000px'"
            [showSidebarButton]="true"
            [showZoomButtons]="true"
            [showPrintButton]="true"
            [showDownloadButton]="true"
            [showPagingButtons]="true"
          ></ngx-extended-pdf-viewer>
        </div>

        <!-- New Button: Get My Note -->
        <button
          class="btn btn-success mt-3"
          (click)="getMyNote()"
          [disabled]="!pdfisupdated"
          aria-label="Get My Note"
        >
          Get My Note
        </button>

        <!-- Progress bar for Get My Note -->
        <div *ngIf="isGettingNote" class="progress mt-3 mb-3">
          <div
            class="progress-bar progress-bar-striped progress-bar-animated"
            role="progressbar"
            [style.width.%]="getNoteProgress"
            [attr.aria-valuenow]="getNoteProgress"
            aria-valuemin="0"
            aria-valuemax="100"
          >
            {{ getNoteProgress }}%
          </div>
        </div>

        <!-- Display Scores -->
        <div *ngIf="customScore || pyresScore" class="mt-4">
          <h4>Custom Analyzer</h4>
          <div *ngIf="customScore">
            <p><strong>Total Score:</strong> {{ customScore.total_score }}</p>
            <p><strong>Skills:</strong> {{ customScore.detailed_scores.skills }}</p>
            <p><strong>Experience:</strong> {{ customScore.detailed_scores.experience }}</p>
            <p><strong>Education:</strong> {{ customScore.detailed_scores.education }}</p>
            <p><strong>Experience Metrics:</strong> {{ customScore.experience_metrics.details }}</p>
            <ul>
              <li *ngFor="let fb of customScore.feedback">{{ fb }}</li>
            </ul>
          </div>
          <h4 class="mt-3">Pyres Analyzer</h4>
          <div *ngIf="pyresScore">
            <p><strong>Total Score:</strong> {{ pyresScore.total_score }}</p>
            <p><strong>Skills:</strong> {{ pyresScore.detailed_scores.skills }}</p>
            <p><strong>Experience:</strong> {{ pyresScore.detailed_scores.experience }}</p>
            <p><strong>Education:</strong> {{ pyresScore.detailed_scores.education }}</p>
            <p><strong>Experience Metrics:</strong> {{ pyresScore.experience_metrics.details }}</p>
            <ul>
              <li *ngFor="let fb of pyresScore.feedback">{{ fb }}</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>